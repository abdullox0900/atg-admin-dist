import{u as $,a as C,r as p,j as e,S as g,o as v,B as q,C as I,s as H,P as O,v as R,w as U,x as L,y as m,z,W,q as w,b as A,X as M,H as X}from"./index-DPVKpS60.js";import{u as P}from"./notistack.esm-PkWn3jSX.js";import{D as N,a as T,b as k}from"./DialogTitle-BGDm12jN.js";import{T as f}from"./TextField-DE_6BPSe.js";import{L as E}from"./LoadingButton-R_CQBUGq.js";import"./useId-DrTdGP2W.js";const b="/price-cards";function y(){const{data:o,error:r,isLoading:s,mutate:t}=$(b,()=>C.get(b).then(i=>i.data));return{priceCards:o||[],isLoading:s,error:r,createPriceCard:async i=>{const a=await C.post(b,i);return t(),a.data},updatePriceCard:async(i,a)=>{const d=await C.put(`${b}/${i}`,a);return t(),d.data},deletePriceCard:async i=>{await C.delete(`${b}/${i}`),t()}}}function _({open:o,onClose:r,onSuccess:s}){const[t,h]=p.useState(""),[c,n]=p.useState(""),[i,a]=p.useState(""),[d,x]=p.useState(!1),{enqueueSnackbar:l}=P(),{createPriceCard:B}=y(),F=async j=>{var S,D;j.preventDefault();try{x(!0);const u={minLiters:Number(t),maxLiters:Number(c),pricePerLiter:Number(i)};if(console.log("Sending data:",u),u.minLiters<=0||u.maxLiters<=0){l("Значения должны быть больше 0",{variant:"error"});return}if(u.minLiters>=u.maxLiters){l("Значение ОТ должно быть меньше значения ДО",{variant:"error"});return}if(Number(u.pricePerLiter)<=0){l("Цена должна быть больше 0",{variant:"error"});return}console.log("Sending data:",u),await B(u),l("Карта успешно создана",{variant:"success"}),r(),s==null||s(),h(""),n(""),a("")}catch(u){console.error("Error details:",u);const V=((D=(S=u.response)==null?void 0:S.data)==null?void 0:D.message)||"Ошибка при создании карты";l(V,{variant:"error"})}finally{x(!1)}};return e.jsxs(N,{open:o,onClose:r,maxWidth:"sm",fullWidth:!0,children:[e.jsx(T,{children:"Создание новой карты"}),e.jsx(k,{children:e.jsx("form",{onSubmit:F,children:e.jsxs(g,{spacing:3,sx:{mt:2},children:[e.jsx(f,{fullWidth:!0,label:"Значение: ОТ",type:"number",value:t,onChange:j=>h(j.target.value),disabled:d,inputProps:{min:0}}),e.jsx(f,{fullWidth:!0,label:"Значение: ДО",type:"number",value:c,onChange:j=>n(j.target.value),disabled:d,inputProps:{min:0}}),e.jsx(f,{fullWidth:!0,label:"Цена (руб/литр)",type:"number",value:i,onChange:j=>a(j.target.value),disabled:d,inputProps:{min:0,step:"0.01"}}),e.jsxs(g,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(v,{onClick:r,disabled:d,children:"Отмена"}),e.jsx(E,{type:"submit",variant:"contained",loading:d,children:"Сохранить"})]})]})})})]})}function G({open:o,card:r,onClose:s}){const[t,h]=p.useState(!1),{enqueueSnackbar:c}=P(),[n,i]=p.useState({minLiters:0,maxLiters:0,pricePerLiter:0}),{updatePriceCard:a}=y();p.useEffect(()=>{r&&o&&i({minLiters:r.minLiters,maxLiters:r.maxLiters,pricePerLiter:Number(r.pricePerLiter)})},[r,o]);const d=async x=>{if(x.preventDefault(),!!(r!=null&&r.id))try{if(h(!0),n.minLiters<=0||n.maxLiters<=0){c("Значения должны быть больше 0",{variant:"error"});return}if(n.minLiters>=n.maxLiters){c("Значение ОТ должно быть меньше значения ДО",{variant:"error"});return}if(Number(n.pricePerLiter)<=0){c("Цена должна быть больше 0",{variant:"error"});return}await a(r.id,n),c("Карта успешно обновлена",{variant:"success"}),s()}catch(l){console.error("Error updating card:",l),c("Ошибка при обновлении карты",{variant:"error"})}finally{h(!1)}};return e.jsxs(N,{open:o,onClose:s,maxWidth:"sm",fullWidth:!0,children:[e.jsx(T,{children:"Редактирование карты"}),e.jsx(k,{children:e.jsx("form",{onSubmit:d,children:e.jsxs(g,{spacing:3,sx:{mt:2},children:[e.jsx(f,{fullWidth:!0,label:"Значение: ОТ",type:"number",value:n.minLiters,onChange:x=>i(l=>({...l,minLiters:Number(x.target.value)})),disabled:t,inputProps:{min:0}}),e.jsx(f,{fullWidth:!0,label:"Значение: ДО",type:"number",value:n.maxLiters,onChange:x=>i(l=>({...l,maxLiters:Number(x.target.value)})),disabled:t,inputProps:{min:0}}),e.jsx(f,{fullWidth:!0,label:"Цена (руб/литр)",type:"number",value:n.pricePerLiter,onChange:x=>i(l=>({...l,pricePerLiter:Number(x.target.value)})),disabled:t,inputProps:{min:0,step:"0.01"}}),e.jsxs(g,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(v,{onClick:s,disabled:t,children:"Отмена"}),e.jsx(E,{type:"submit",variant:"contained",loading:t,children:"Сохранить"})]})]})})})]})}function J(){const[o,r]=p.useState({open:!1}),{enqueueSnackbar:s}=P(),{priceCards:t,isLoading:h,error:c,deletePriceCard:n}=y(),i=async a=>{try{await n(a),s("Карта успешно удалена",{variant:"success"})}catch(d){console.error("Error deleting card:",d),s("Ошибка при удалении карты",{variant:"error"})}};return c?e.jsx("div",{children:"Ошибка загрузки данных"}):h?e.jsx(q,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(I,{})}):e.jsxs(e.Fragment,{children:[e.jsx(H,{component:O,children:e.jsxs(R,{children:[e.jsx(U,{children:e.jsxs(L,{children:[e.jsx(m,{children:"От (литров)"}),e.jsx(m,{children:"До (литров)"}),e.jsx(m,{children:"Цена (руб/литр)"}),e.jsx(m,{align:"right",children:"Действия"})]})}),e.jsx(z,{children:t&&t.length>0?t.map(a=>e.jsxs(L,{children:[e.jsx(m,{children:a.minLiters}),e.jsx(m,{children:a.maxLiters}),e.jsx(m,{children:`${Number(a.pricePerLiter)}₽`}),e.jsxs(m,{align:"right",children:[e.jsx(W,{onClick:()=>r({open:!0,card:a}),children:e.jsx(w,{icon:"eva:edit-fill"})}),e.jsx(W,{onClick:()=>i(a.id),color:"error",children:e.jsx(w,{icon:"eva:trash-2-fill"})})]})]},a.id)):e.jsx(L,{children:e.jsx(m,{colSpan:5,align:"center",children:"Нет данных"})})})]})}),e.jsx(G,{open:o.open,card:o.card,onClose:()=>r({open:!1})})]})}function K(){const[o,r]=p.useState(!1),s=()=>r(!0),t=()=>r(!1);return e.jsx(A,{maxWidth:"lg",children:e.jsxs(g,{spacing:3,children:[e.jsx(g,{direction:"row",justifyContent:"flex-end",children:e.jsx(v,{variant:"contained",onClick:s,children:"Добавить Карту"})}),e.jsx(J,{}),e.jsx(_,{open:o,onClose:t,onSuccess:()=>{M("/price-cards")}})]})})}function ie(){return e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsx("title",{children:"Create"})}),e.jsx(K,{})]})}export{ie as default};
